<UserControl x:Class="Sai2Capture.Views.MainPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:converters="clr-namespace:Sai2Capture.Converters"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800">
    <UserControl.Resources>
        <ResourceDictionary>
            <!-- 通用转换器 -->
            <converters:UniversalConverter x:Key="UniversalConverter" />
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Capture Settings Card -->
        <ui:Card Grid.Row="0" Margin="0,0,0,16">
            <StackPanel>
                <TextBlock Text="SAI2窗口选择" Style="{StaticResource CardTitleStyle}"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock 
                        Grid.Column="0" 
                        Text="窗口名称:" 
                        Style="{StaticResource LabelStyle}"
                        Margin="0,0,12,0"/>
                    <ComboBox
                        Grid.Column="1"
                        ItemsSource="{Binding WindowTitles}"
                        Text="{Binding SelectedWindowTitle, UpdateSourceTrigger=PropertyChanged}"
                        FontWeight="Normal"
                        IsEditable="True"
                        Margin="0,0,12,0" />
                    <ui:Button
                        Grid.Column="2"
                        Content="刷新"
                        Command="{Binding RefreshWindowListCommand}"
                        ToolTip="重新扫描系统进程，查找SAI2相关窗口"/>
                </Grid>
            </StackPanel>
        </ui:Card>

        <!-- Control Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,16">
            <ui:Button 
                Appearance="Primary"
                Content="开始/继续" 
                Command="{Binding StartCaptureCommand}" 
                Margin="0,0,12,0"/>
            <ui:Button 
                Content="暂停" 
                Command="{Binding PauseCaptureCommand}" 
                Margin="0,0,12,0"/>
            <ui:Button 
                Content="停止录制" 
                Command="{Binding StopCaptureCommand}" 
                Margin="0,0,12,0"/>
            <ui:Button
                Content="预览窗口"
                Command="{Binding PreviewWindowCommand}"
                Margin="0,0,12,0"/>
            <ui:Button
                Content="启动 SAI2"
                Command="{Binding LaunchSai2Command}"
                Appearance="Secondary"
                ToolTip="启动 SAI2 应用程序"
                IsEnabled="{Binding Sai2Path, Converter={StaticResource UniversalConverter}, ConverterParameter=StringToEnabled}"/>
        </StackPanel>

        <!-- Status Display -->
        <ui:Card Grid.Row="3" Margin="0">
            <TextBlock 
                Text="{Binding Status}" 
                FontWeight="SemiBold"
                HorizontalAlignment="Center"/>
        </ui:Card>
    </Grid>
</UserControl>
