<Window
    x:Class="Sai2Capture.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:Sai2Capture"
    xmlns:converters="clr-namespace:Sai2Capture.Converters"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    mc:Ignorable="d"
    Title="Sai2 捕获工具"
    Height="450"
    Width="900"
    Closing="Window_Closing">

    <TabControl Margin="8">
        <!-- 主页面标签页 -->
        <TabItem Header="主页面">
            <Grid Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Capture Settings Card -->
                <ui:Card Grid.Row="0" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="窗口捕获设置" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12"/>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- 替换 ui:Label → TextBlock -->
                            <TextBlock 
                                Grid.Row="0" Grid.Column="0" 
                                Text="窗口名称:" 
                                Margin="0,0,12,12" 
                                VerticalAlignment="Center"/>
                            <ComboBox
                                Grid.Row="0" Grid.Column="1"
                                ItemsSource="{Binding WindowTitles}"
                                Text="{Binding SelectedWindowTitle, UpdateSourceTrigger=PropertyChanged}"
                                IsEditable="True"
                                Margin="0,0,12,12" />
                            <ui:Button
                                Grid.Row="0" Grid.Column="2"
                                Content="刷新"
                                Command="{Binding RefreshWindowListCommand}"
                                Margin="0,0,0,12"
                                ToolTip="刷新窗口列表"/>

                            <TextBlock 
                                Grid.Row="1" Grid.Column="0" 
                                Text="捕获间隔(秒):" 
                                Margin="0,0,12,12" 
                                VerticalAlignment="Center"/>
                            <ui:NumberBox 
                                Grid.Row="1" Grid.Column="1"
                                Value="{Binding CaptureInterval}"
                                Margin="0,0,0,12"
                                Minimum="0.1" Maximum="10" SmallChange="0.1"/>

                            <TextBlock 
                                Grid.Row="2" Grid.Column="0" 
                                Text="保存路径:" 
                                Margin="0,0,12,0" 
                                VerticalAlignment="Center"/>
                            <ui:TextBox 
                                Grid.Row="2" Grid.Column="1"
                                Text="{Binding SavePath}" 
                                Margin="0,0,12,0"/>
                            <ui:Button
                                Grid.Row="2" Grid.Column="2"
                                Content="浏览"
                                Command="{Binding BrowseSavePathCommand}"/>
                        </Grid>
                    </StackPanel>
                </ui:Card>

                <!-- Control Buttons -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,16">
                    <ui:Button 
                        Appearance="Primary"
                        Content="开始/继续" 
                        Command="{Binding StartCaptureCommand}" 
                        Margin="0,0,12,0"/>
                    <ui:Button 
                        Content="暂停" 
                        Command="{Binding PauseCaptureCommand}" 
                        Margin="0,0,12,0"/>
                    <ui:Button 
                        Content="停止录制" 
                        Command="{Binding StopCaptureCommand}" 
                        Margin="0,0,12,0"/>
                    <ui:Button 
                        Content="预览窗口" 
                        Command="{Binding PreviewWindowCommand}"/>
                </StackPanel>

                <!-- Status Display -->
                <ui:Card Grid.Row="4" Margin="0">
                    <TextBlock 
                        Text="{Binding Status}" 
                        FontWeight="SemiBold"
                        HorizontalAlignment="Center"/>
                </ui:Card>
            </Grid>
        </TabItem>

        <!-- 系统日志标签页 -->
        <TabItem Header="系统日志">
            <Grid Margin="16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 日志工具栏 -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
                    <ui:Button 
                        Content="清空日志" 
                        Command="{Binding ClearLogCommand}" 
                        Margin="0,0,12,0"/>
                    <ui:Button 
                        Content="导出日志" 
                        Command="{Binding ExportLogCommand}"
                        Margin="0,0,12,0"/>
                    <CheckBox 
                        Content="自动滚动" 
                        IsChecked="{Binding AutoScrollLog}"
                        VerticalAlignment="Center"
                        Margin="0,0,12,0"/>
                    <TextBlock 
                        Text="过滤级别:" 
                        VerticalAlignment="Center"
                        Margin="0,0,8,0"/>
                    <ComboBox 
                        SelectedItem="{Binding LogFilterLevel}"
                        VerticalAlignment="Center"
                        Width="100">
                        <ComboBoxItem Content="全部"/>
                        <ComboBoxItem Content="INFO"/>
                        <ComboBoxItem Content="WARNING"/>
                        <ComboBoxItem Content="ERROR"/>
                    </ComboBox>
                </StackPanel>

                <!-- 日志显示区域 -->
                <ui:Card Grid.Row="1" Margin="0,0,0,12">
                    <ScrollViewer 
                        x:Name="LogScrollViewer"
                        VerticalScrollBarVisibility="Auto" 
                        HorizontalScrollBarVisibility="Auto">
                        <TextBox 
                            Text="{Binding LogContent, Mode=OneWay}"
                            IsReadOnly="True"
                            TextWrapping="NoWrap"
                            FontFamily="Consolas"
                            FontSize="11"
                            Background="Transparent"
                            BorderThickness="0"
                            VerticalScrollBarVisibility="Disabled"
                            HorizontalScrollBarVisibility="Disabled"
                            Padding="8"/>
                    </ScrollViewer>
                </ui:Card>

                <!-- 日志统计信息 -->
                <ui:Card Grid.Row="2">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock 
                            Text="{Binding LogStatistics}" 
                            FontSize="11"
                            Foreground="Gray"/>
                        <TextBlock 
                            Text=" | 提示: 取消勾选'自动滚动'可查看历史日志" 
                            FontSize="11"
                            Foreground="Gray"
                            Margin="12,0,0,0"/>
                    </StackPanel>
                </ui:Card>
            </Grid>
        </TabItem>
    </TabControl>
</Window>